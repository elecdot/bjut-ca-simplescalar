# config.yaml

sim:
  sim_cache: "sim-cache"        # 如果不在 PATH，可以写绝对路径
  max_workers: 10 # 4                # 并行跑几个实验（逻辑核数的一半左右比较稳妥）
  output_dir: "results"         # 所有 sim-cache 输出和分析结果目录
  base_options:                 # 所有实验通用的 Cache 选项
    - "-cache:il1 il1:256:32:1:l"   # 显式定义 il1，兼容旧版 sim-cache，避免 il1 未定义错误
    - "-cache:il2 dl2"

programs:
  seq_scan:
    path: "bin/seq_scan.ss"
    args: ["8000000", "4"]      # N=8M, repeat=4
  matmul:
    path: "bin/matmul.ss"
    args: ["256"]               # N=256
  random_list:
    path: "bin/random_list.ss"
    args: ["1048576", "4194304"]  # n=1M, steps=4*n

experiments:
  # seq_scan #########################################################################
  # 1) 固定在 seq_scan 上：改变 L1 容量（通过 nsets 变化，assoc=2, bsize=32）
  capacity:
    program: "seq_scan"
    description: "Vary L1 data cache capacity via nsets (assoc=2, bsize=32)"
    configs:
      - id: "cap_x1"
        label: "2KB (32x32x2)"
        options:
          - "-cache:dl1 dl1:32:32:2:l"
      - id: "cap_x2"
        label: "4KB (64x32x2)"
        options:
          - "-cache:dl1 dl1:64:32:2:l"
      - id: "cap_x4"
        label: "8KB (128x32x2)"
        options:
          - "-cache:dl1 dl1:128:32:2:l"
      - id: "cap_x8"
        label: "16KB (256x32x2)"
        options:
          - "-cache:dl1 dl1:256:32:2:l"
      - id: "cap_x64"
        label: "128KB (2048x32x2)"
        options:
          - "-cache:dl1 dl1:2048:32:2:l"

  # 2) 固定在 seq_scan 上：改变 L1 相联度（容量约 2KB 不变）
  associativity:
    program: "seq_scan"
    description: "Vary L1 associativity at roughly 2KB total size (bsize=32)"
    configs:
      - id: "assoc_1way"
        label: "1-way (64x32x1)"
        options:
          - "-cache:dl1 dl1:64:32:1:l"
      - id: "assoc_2way"
        label: "2-way (32x32x2)"
        options:
          - "-cache:dl1 dl1:32:32:2:l"
      - id: "assoc_4way"
        label: "4-way (16x32x4)"
        options:
          - "-cache:dl1 dl1:16:32:4:l"
      - id: "assoc_8way"
        label: "8-way (8x32x8)"
        options:
          - "-cache:dl1 dl1:8:32:8:l"
      - id: "assoc_64way"
        label: "64-way (1x32x64)"
        options:
          - "-cache:dl1 dl1:1:32:64:l"

  # 3) 固定在 seq_scan 上：改变 L1 块大小（实验设置原因，令容量约 4KB，assoc=2）
  blocksize:
    program: "seq_scan"
    description: "Vary L1 block size at roughly 4KB total size (assoc=2)"
    configs:
      - id: "bsize_32"
        label: "32B (64x32x2)"
        options:
          - "-cache:dl1 dl1:64:32:2:l"
          - "-cache:dl2 ul2:1024:2048:4:l"   # L2 块大于等于最大 L1 块，避免跨块错误
      - id: "bsize_64"
        label: "64B (32x64x2)"
        options:
          - "-cache:dl1 dl1:32:64:2:l"
          - "-cache:dl2 ul2:1024:2048:4:l"
      - id: "bsize_128"
        label: "128B (16x128x2)"
        options:
          - "-cache:dl1 dl1:16:128:2:l"
          - "-cache:dl2 ul2:1024:2048:4:l"
      - id: "bsize_256"
        label: "256B (8x256x2)"
        options:
          - "-cache:dl1 dl1:8:256:2:l"
          - "-cache:dl2 ul2:1024:2048:4:l"
      - id: "bsize_2048"
        label: "2048B (1x2048x2)"
        options:
          - "-cache:dl1 dl1:1:2048:2:l"
          - "-cache:dl2 ul2:1024:2048:4:l"

  #  matmul #########################################################################
  # 1) matmul 改变 L1 容量（通过 nsets 变化，assoc=2, bsize=32）
  capacity_matmul:
    program: "matmul"
    description: "Vary L1 data cache capacity via nsets (assoc=2, bsize=32)"
    configs:
      - id: "cap_x1"
        label: "2KB (32x32x2)"
        options:
          - "-cache:dl1 dl1:32:32:2:l"
      - id: "cap_x2"
        label: "4KB (64x32x2)"
        options:
          - "-cache:dl1 dl1:64:32:2:l"
      - id: "cap_x4"
        label: "8KB (128x32x2)"
        options:
          - "-cache:dl1 dl1:128:32:2:l"
      - id: "cap_x8"
        label: "16KB (256x32x2)"
        options:
          - "-cache:dl1 dl1:256:32:2:l"
      - id: "cap_x64"
        label: "128KB (2048x32x2)"
        options:
          - "-cache:dl1 dl1:2048:32:2:l"
  # 2) matmul ：改变 L1 相联度（容量约 2KB 不变）
  assoc_matmul:
    program: "matmul"
    description: "Key associativity points for matmul at ~2KB L1"
    configs:
      - id: "mm_assoc_1way"
        label: "matmul 1-way"
        options:
          - "-cache:dl1 dl1:64:32:1:l"
      - id: "mm_assoc_2way"
        label: "matmul 2-way"
        options:
          - "-cache:dl1 dl1:32:32:2:l"
      - id: "mm_assoc_4way"
        label: "matmul 4-way"
        options:
          - "-cache:dl1 dl1:16:32:4:l"
      - id: "mm_assoc_8way"
        label: "matmul 8-way"
        options:
          - "-cache:dl1 dl1:8:32:8:l"
      - id: "mm_assoc_32way"
        label: "matmul 32-way"
        options:
          - "-cache:dl1 dl1:2:32:32:l"
      - id: "mm_assoc_64way"
        label: "matmul 64-way"
        options:
          - "-cache:dl1 dl1:1:32:64:l"
  # 3) matmul ：改变 L1 块大小（实验设置原因，令容量约 4KB，assoc=2）
  blocksize_matmul:
    program: "matmul"
    description: "Vary L1 block size at roughly 4KB total size (assoc=2)"
    configs:
      - id: "bsize_32"
        label: "32B (64x32x2)"
        options:
          - "-cache:dl1 dl1:64:32:2:l"
          - "-cache:dl2 ul2:1024:2048:4:l"   # L2 块大于等于最大 L1 块，避免跨块错误
      - id: "bsize_64"
        label: "64B (32x64x2)"
        options:
          - "-cache:dl1 dl1:32:64:2:l"
          - "-cache:dl2 ul2:1024:2048:4:l"
      - id: "bsize_128"
        label: "128B (16x128x2)"
        options:
          - "-cache:dl1 dl1:16:128:2:l"
          - "-cache:dl2 ul2:1024:2048:4:l"
      - id: "bsize_256"
        label: "256B (8x256x2)"
        options:
          - "-cache:dl1 dl1:8:256:2:l"
          - "-cache:dl2 ul2:1024:2048:4:l"
      - id: "bsize_2048"
        label: "2048B (1x2048x2)"
        options:
          - "-cache:dl1 dl1:1:2048:2:l"
          - "-cache:dl2 ul2:1024:2048:4:l"

  # random_list ###################################################################### 
  # 1) random_list 改变 L1 容量（通过 nsets 变化，assoc=2, bsize=32）
  capacity_random:
    program: "random_list"
    description: "Vary L1 data cache capacity via nsets (assoc=2, bsize=32)"
    configs:
      - id: "cap_x1"
        label: "2KB (32x32x2)"
        options:
          - "-cache:dl1 dl1:32:32:2:l"
      - id: "cap_x2"
        label: "4KB (64x32x2)"
        options:
          - "-cache:dl1 dl1:64:32:2:l"
      - id: "cap_x4"
        label: "8KB (128x32x2)"
        options:
          - "-cache:dl1 dl1:128:32:2:l"
      - id: "cap_x8"
        label: "16KB (256x32x2)"
        options:
          - "-cache:dl1 dl1:256:32:2:l"
      - id: "cap_x64"
        label: "128KB (2048x32x2)"
        options:
          - "-cache:dl1 dl1:2048:32:2:l"
  # 2) random_list ：改变 L1 相联度（容量约 2KB 不变）
  assoc_random:
    program: "random_list"
    description: "Key associativity points for random list at ~2KB L1"
    configs:
      - id: "rl_assoc_1way"
        label: "random_list 1-way"
        options:
          - "-cache:dl1 dl1:64:32:1:l"
      - id: "rl_assoc_2way"
        label: "random_list 2-way"
        options:
          - "-cache:dl1 dl1:32:32:2:l"
      - id: "rl_assoc_4way"
        label: "random_list 4-way"
        options:
          - "-cache:dl1 dl1:16:32:4:l"
      - id: "rl_assoc_8way"
        label: "random_list 8-way"
        options:
          - "-cache:dl1 dl1:8:32:8:l"
      - id: "rl_assoc_32way"
        label: "random_list 32-way"
        options:
          - "-cache:dl1 dl1:2:32:32:l"
      - id: "rl_assoc_64way"
        label: "random_list 64-way"
        options:
          - "-cache:dl1 dl1:1:32:64:l"
  # 3) random_list ：改变 L1 块大小（实验设置原因，令容量约 4KB，assoc=2）
  blocksize_random:
    program: "random_list"
    description: "Vary L1 block size at roughly 4KB total size (assoc=2)"
    configs:
      - id: "bsize_32"
        label: "32B (64x32x2)"
        options:
          - "-cache:dl1 dl1:64:32:2:l"
          - "-cache:dl2 ul2:1024:2048:4:l"   # L2 块大于等于最大 L1 块，避免跨块错误
      - id: "bsize_64"
        label: "64B (32x64x2)"
        options:
          - "-cache:dl1 dl1:32:64:2:l"
          - "-cache:dl2 ul2:1024:2048:4:l"
      - id: "bsize_128"
        label: "128B (16x128x2)"
        options:
          - "-cache:dl1 dl1:16:128:2:l"
          - "-cache:dl2 ul2:1024:2048:4:l"
      - id: "bsize_256"
        label: "256B (8x256x2)"
        options:
          - "-cache:dl1 dl1:8:256:2:l"
          - "-cache:dl2 ul2:1024:2048:4:l"
      - id: "bsize_2048"
        label: "2048B (1x2048x2)"
        options:
          - "-cache:dl1 dl1:1:2048:2:l"
          - "-cache:dl2 ul2:1024:2048:4:l"


  # 替换策略对比：LRU vs Random（保持容量/块/相联度一致）#######################################
  substitute:
    program: "seq_scan"
    description: "Replacement policy comparison (LRU vs Random) across sizes/assocs"
    configs:
      - id: "sub_2kb_1way_lru"
        label: "2KB 1-way LRU (64x32x1)"
        options:
          - "-cache:dl1 dl1:64:32:1:l"
      - id: "sub_2kb_1way_rand"
        label: "2KB 1-way Rand (64x32x1)"
        options:
          - "-cache:dl1 dl1:64:32:1:r"
      - id: "sub_2kb_2way_lru"
        label: "2KB 2-way LRU (32x32x2)"
        options:
          - "-cache:dl1 dl1:32:32:2:l"
      - id: "sub_2kb_2way_rand"
        label: "2KB 2-way Rand (32x32x2)"
        options:
          - "-cache:dl1 dl1:32:32:2:r"
      - id: "sub_8kb_4way_lru"
        label: "8KB 4-way LRU (64x32x4)"
        options:
          - "-cache:dl1 dl1:64:32:4:l"
      - id: "sub_8kb_4way_rand"
        label: "8KB 4-way Rand (64x32x4)"
        options:
          - "-cache:dl1 dl1:64:32:4:r"
      - id: "sub_32kb_8way_lru"
        label: "32KB 8-way LRU (128x32x8)"
        options:
          - "-cache:dl1 dl1:128:32:8:l"
      - id: "sub_32kb_8way_rand"
        label: "32KB 8-way Rand (128x32x8)"
        options:
          - "-cache:dl1 dl1:128:32:8:r"
